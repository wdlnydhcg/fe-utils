{"version":3,"file":"index.js","sources":["../../../src/index.ts"],"sourcesContent":["type Storage_Type = \"localStorage\" | \"sessionStorage\"\n\nexport interface StorageDataShape {\n  value: unknown\n  time: number\n  expire: number\n}\n\nexport default class ILLAStorage {\n  prefix: string = \"ILLA_STORAGE@0.0.1\"\n  defaultExpire: number = 5\n\n  constructor(prefix?: string, defaultExpire?: number) {\n    if (prefix != undefined) {\n      this.prefix = prefix\n    }\n    if (defaultExpire != undefined) {\n      this.defaultExpire = defaultExpire\n    }\n  }\n\n  private autoAddPrefix(key: string): string {\n    return `${this.prefix}/${key}`\n  }\n\n  private setStorage = (\n    type: Storage_Type,\n    key: string,\n    value: unknown,\n    expire: number = -1,\n  ): void => {\n    if (value == \"\" || value == undefined) {\n      value = null\n    }\n    if (isNaN(expire)) {\n      expire = this.defaultExpire\n    }\n\n    let data: StorageDataShape = {\n      value: value,\n      time: Date.now(),\n      expire,\n    }\n\n    try {\n      const stringifyData = JSON.stringify(data)\n      window[type].setItem(this.autoAddPrefix(key), stringifyData)\n    } catch (e) {\n      console.error(`[ILLA_STORAGE] setStorage error: ${e}`)\n    }\n  }\n\n  private getStorage = (type: Storage_Type, key: string): unknown => {\n    const prefixKey = this.autoAddPrefix(key)\n    if (!window[type].getItem(prefixKey)) {\n      return undefined\n    }\n    let storage: StorageDataShape | undefined = undefined\n    try {\n      const stringifyData = window[type].getItem(prefixKey)\n      if (stringifyData == undefined) {\n        return undefined\n      }\n      storage = JSON.parse(stringifyData)\n    } catch (e) {\n      console.error(`[ILLA_STORAGE] getStorage error: ${e}`)\n      return undefined\n    }\n\n    let nowTime = Date.now()\n\n    if (storage == undefined) {\n      return undefined\n    }\n\n    if (\n      storage.expire > -1 &&\n      storage.expire * 60 * 1000 < nowTime - storage.time\n    ) {\n      this.removeStorage(type, key)\n      return undefined\n    } else {\n      this.setStorage(type, key, storage.value, storage.expire)\n      return storage.value\n    }\n  }\n\n  private clearStorage = (type: Storage_Type) => {\n    window[type].clear()\n  }\n\n  private removeStorage = (type: Storage_Type, key: string) => {\n    window[type].removeItem(this.autoAddPrefix(key))\n  }\n\n  public setLocalStorage = (key: string, value: unknown, expire?: number) => {\n    this.setStorage(\"localStorage\", key, value, expire)\n  }\n\n  public getLocalStorage = (key: string): unknown => {\n    return this.getStorage(\"localStorage\", key)\n  }\n\n  public clearLocalStorage = () => {\n    this.clearStorage(\"localStorage\")\n  }\n\n  public removeLocalStorage = (key: string) => {\n    this.removeStorage(\"localStorage\", key)\n  }\n\n  public setSessionStorage = (key: string, value: unknown, expire?: number) => {\n    this.setStorage(\"sessionStorage\", key, value, expire)\n  }\n\n  public getSessionStorage = (key: string): unknown => {\n    return this.getStorage(\"sessionStorage\", key)\n  }\n\n  public clearSessionStorage = () => {\n    this.clearStorage(\"sessionStorage\")\n  }\n\n  public removeSessionStorage = (key: string) => {\n    this.removeStorage(\"sessionStorage\", key)\n  }\n}\n"],"names":["ILLAStorage","prefix","defaultExpire","__publicField","type","key","value","expire","data","stringifyData","e","prefixKey","storage","nowTime"],"mappings":";;;AAQA,MAAqBA,EAAW;AAAA,EAI9B,YAAYC,GAAiBC,GAAsB;AAHnD,IAAAC,EAAA,gBAAiB;AACjB,IAAAA,EAAA,uBAAwB;AAehB,IAAAA,EAAA,oBAAa,CACnBC,GACAC,GACAC,GACAC,IAAiB,OACT;AACJ,OAAAD,KAAS,MAAMA,KAAS,UAClBA,IAAA,OAEN,MAAMC,CAAM,MACdA,IAAS,KAAK;AAGhB,UAAIC,IAAyB;AAAA,QAC3B,OAAAF;AAAA,QACA,MAAM,KAAK,IAAK;AAAA,QAChB,QAAAC;AAAA,MAAA;AAGE,UAAA;AACI,cAAAE,IAAgB,KAAK,UAAUD,CAAI;AACzC,eAAOJ,GAAM,QAAQ,KAAK,cAAcC,CAAG,GAAGI,CAAa;AAAA,eACpDC;AACC,gBAAA,MAAM,oCAAoCA,GAAG;AAAA,MACtD;AAAA,IAAA;AAGK,IAAAP,EAAA,oBAAa,CAACC,GAAoBC,MAAwB;AAC1D,YAAAM,IAAY,KAAK,cAAcN,CAAG;AACxC,UAAI,CAAC,OAAOD,GAAM,QAAQO,CAAS;AAC1B;AAET,UAAIC;AACA,UAAA;AACF,cAAMH,IAAgB,OAAOL,GAAM,QAAQO,CAAS;AACpD,YAAIF,KAAiB;AACZ;AAEC,QAAAG,IAAA,KAAK,MAAMH,CAAa;AAAA,eAC3BC;AACC,gBAAA,MAAM,oCAAoCA,GAAG;AAC9C;AAAA,MACR;AAEG,UAAAG,IAAU,KAAK;AAEnB,UAAID,KAAW;AAKb,YAAAA,EAAQ,SAAS,MACjBA,EAAQ,SAAS,KAAK,MAAOC,IAAUD,EAAQ,MAC/C;AACK,eAAA,cAAcR,GAAMC,CAAG;AACrB;AAAA,QAAA;AAEP,sBAAK,WAAWD,GAAMC,GAAKO,EAAQ,OAAOA,EAAQ,MAAM,GACjDA,EAAQ;AAAA,IAChB;AAGK,IAAAT,EAAA,sBAAe,CAACC,MAAsB;AAC5C,aAAOA,GAAM;;AAGP,IAAAD,EAAA,uBAAgB,CAACC,GAAoBC,MAAe;AAC1D,aAAOD,GAAM,WAAW,KAAK,cAAcC,CAAG,CAAC;AAAA,IAAA;AAG1C,IAAAF,EAAA,yBAAkB,CAACE,GAAaC,GAAgBC,MAAmB;AACxE,WAAK,WAAW,gBAAgBF,GAAKC,GAAOC,CAAM;AAAA,IAAA;AAG7C,IAAAJ,EAAA,yBAAkB,CAACE,MACjB,KAAK,WAAW,gBAAgBA,CAAG;AAGrC,IAAAF,EAAA,2BAAoB,MAAK;AAC9B,WAAK,aAAa,cAAc;AAAA,IAAA;AAG3B,IAAAA,EAAA,4BAAqB,CAACE,MAAe;AACrC,WAAA,cAAc,gBAAgBA,CAAG;AAAA,IAAA;AAGjC,IAAAF,EAAA,2BAAoB,CAACE,GAAaC,GAAgBC,MAAmB;AAC1E,WAAK,WAAW,kBAAkBF,GAAKC,GAAOC,CAAM;AAAA,IAAA;AAG/C,IAAAJ,EAAA,2BAAoB,CAACE,MACnB,KAAK,WAAW,kBAAkBA,CAAG;AAGvC,IAAAF,EAAA,6BAAsB,MAAK;AAChC,WAAK,aAAa,gBAAgB;AAAA,IAAA;AAG7B,IAAAA,EAAA,8BAAuB,CAACE,MAAe;AACvC,WAAA,cAAc,kBAAkBA,CAAG;AAAA,IAAA;AA/GxC,IAAIJ,KAAU,SACZ,KAAK,SAASA,IAEZC,KAAiB,SACnB,KAAK,gBAAgBA;AAAA,EAEzB;AAAA,EAEQ,cAAcG,GAAW;AACxB,WAAA,GAAG,KAAK,UAAUA;AAAA,EAC3B;AAuGD;"}