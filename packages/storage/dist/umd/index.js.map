{"version":3,"file":"index.js","sources":["../../../src/index.ts"],"sourcesContent":["type Storage_Type = \"localStorage\" | \"sessionStorage\"\n\nexport interface StorageDataShape {\n  value: unknown\n  time: number\n  expire: number\n}\n\nexport default class ILLAStorage {\n  prefix: string = \"ILLA_STORAGE@0.0.1\"\n  defaultExpire: number = 5\n\n  constructor(prefix?: string, defaultExpire?: number) {\n    if (prefix != undefined) {\n      this.prefix = prefix\n    }\n    if (defaultExpire != undefined) {\n      this.defaultExpire = defaultExpire\n    }\n  }\n\n  private autoAddPrefix(key: string): string {\n    return `${this.prefix}/${key}`\n  }\n\n  private setStorage = (\n    type: Storage_Type,\n    key: string,\n    value: unknown,\n    expire: number = -1,\n  ): void => {\n    if (value == \"\" || value == undefined) {\n      value = null\n    }\n    if (isNaN(expire)) {\n      expire = this.defaultExpire\n    }\n\n    let data: StorageDataShape = {\n      value: value,\n      time: Date.now(),\n      expire,\n    }\n\n    try {\n      const stringifyData = JSON.stringify(data)\n      window[type].setItem(this.autoAddPrefix(key), stringifyData)\n    } catch (e) {\n      console.error(`[ILLA_STORAGE] setStorage error: ${e}`)\n    }\n  }\n\n  private getStorage = (type: Storage_Type, key: string): unknown => {\n    const prefixKey = this.autoAddPrefix(key)\n    if (!window[type].getItem(prefixKey)) {\n      return undefined\n    }\n    let storage: StorageDataShape | undefined = undefined\n    try {\n      const stringifyData = window[type].getItem(prefixKey)\n      if (stringifyData == undefined) {\n        return undefined\n      }\n      storage = JSON.parse(stringifyData)\n    } catch (e) {\n      console.error(`[ILLA_STORAGE] getStorage error: ${e}`)\n      return undefined\n    }\n\n    let nowTime = Date.now()\n\n    if (storage == undefined) {\n      return undefined\n    }\n\n    if (\n      storage.expire > -1 &&\n      storage.expire * 60 * 1000 < nowTime - storage.time\n    ) {\n      this.removeStorage(type, key)\n      return undefined\n    } else {\n      this.setStorage(type, key, storage.value, storage.expire)\n      return storage.value\n    }\n  }\n\n  private clearStorage = (type: Storage_Type) => {\n    window[type].clear()\n  }\n\n  private removeStorage = (type: Storage_Type, key: string) => {\n    window[type].removeItem(this.autoAddPrefix(key))\n  }\n\n  public setLocalStorage = (key: string, value: unknown, expire?: number) => {\n    this.setStorage(\"localStorage\", key, value, expire)\n  }\n\n  public getLocalStorage = (key: string): unknown => {\n    return this.getStorage(\"localStorage\", key)\n  }\n\n  public clearLocalStorage = () => {\n    this.clearStorage(\"localStorage\")\n  }\n\n  public removeLocalStorage = (key: string) => {\n    this.removeStorage(\"localStorage\", key)\n  }\n\n  public setSessionStorage = (key: string, value: unknown, expire?: number) => {\n    this.setStorage(\"sessionStorage\", key, value, expire)\n  }\n\n  public getSessionStorage = (key: string): unknown => {\n    return this.getStorage(\"sessionStorage\", key)\n  }\n\n  public clearSessionStorage = () => {\n    this.clearStorage(\"sessionStorage\")\n  }\n\n  public removeSessionStorage = (key: string) => {\n    this.removeStorage(\"sessionStorage\", key)\n  }\n}\n"],"names":["ILLAStorage","prefix","defaultExpire","__publicField","type","key","value","expire","data","stringifyData","e","prefixKey","storage","nowTime"],"mappings":"4YAQA,MAAqBA,CAAW,CAI9B,YAAYC,EAAiBC,EAAsB,CAHnDC,EAAA,cAAiB,sBACjBA,EAAA,qBAAwB,GAehBA,EAAA,kBAAa,CACnBC,EACAC,EACAC,EACAC,EAAiB,KACT,EACJD,GAAS,IAAMA,GAAS,QAClBA,EAAA,MAEN,MAAMC,CAAM,IACdA,EAAS,KAAK,eAGhB,IAAIC,EAAyB,CAC3B,MAAAF,EACA,KAAM,KAAK,IAAK,EAChB,OAAAC,CAAA,EAGE,GAAA,CACI,MAAAE,EAAgB,KAAK,UAAUD,CAAI,EACzC,OAAOJ,GAAM,QAAQ,KAAK,cAAcC,CAAG,EAAGI,CAAa,QACpDC,GACC,QAAA,MAAM,oCAAoCA,GAAG,CACtD,CAAA,GAGKP,EAAA,kBAAa,CAACC,EAAoBC,IAAwB,CAC1D,MAAAM,EAAY,KAAK,cAAcN,CAAG,EACxC,GAAI,CAAC,OAAOD,GAAM,QAAQO,CAAS,EAC1B,OAET,IAAIC,EACA,GAAA,CACF,MAAMH,EAAgB,OAAOL,GAAM,QAAQO,CAAS,EACpD,GAAIF,GAAiB,KACZ,OAECG,EAAA,KAAK,MAAMH,CAAa,QAC3BC,GACC,QAAA,MAAM,oCAAoCA,GAAG,EAC9C,MACR,CAEG,IAAAG,EAAU,KAAK,MAEnB,GAAID,GAAW,KAKb,GAAAA,EAAQ,OAAS,IACjBA,EAAQ,OAAS,GAAK,IAAOC,EAAUD,EAAQ,KAC/C,CACK,KAAA,cAAcR,EAAMC,CAAG,EACrB,MAAA,KAEP,aAAK,WAAWD,EAAMC,EAAKO,EAAQ,MAAOA,EAAQ,MAAM,EACjDA,EAAQ,KAChB,GAGKT,EAAA,oBAAgBC,GAAsB,CAC5C,OAAOA,GAAM,UAGPD,EAAA,qBAAgB,CAACC,EAAoBC,IAAe,CAC1D,OAAOD,GAAM,WAAW,KAAK,cAAcC,CAAG,CAAC,CAAA,GAG1CF,EAAA,uBAAkB,CAACE,EAAaC,EAAgBC,IAAmB,CACxE,KAAK,WAAW,eAAgBF,EAAKC,EAAOC,CAAM,CAAA,GAG7CJ,EAAA,uBAAmBE,GACjB,KAAK,WAAW,eAAgBA,CAAG,GAGrCF,EAAA,yBAAoB,IAAK,CAC9B,KAAK,aAAa,cAAc,CAAA,GAG3BA,EAAA,0BAAsBE,GAAe,CACrC,KAAA,cAAc,eAAgBA,CAAG,CAAA,GAGjCF,EAAA,yBAAoB,CAACE,EAAaC,EAAgBC,IAAmB,CAC1E,KAAK,WAAW,iBAAkBF,EAAKC,EAAOC,CAAM,CAAA,GAG/CJ,EAAA,yBAAqBE,GACnB,KAAK,WAAW,iBAAkBA,CAAG,GAGvCF,EAAA,2BAAsB,IAAK,CAChC,KAAK,aAAa,gBAAgB,CAAA,GAG7BA,EAAA,4BAAwBE,GAAe,CACvC,KAAA,cAAc,iBAAkBA,CAAG,CAAA,GA/GpCJ,GAAU,OACZ,KAAK,OAASA,GAEZC,GAAiB,OACnB,KAAK,cAAgBA,EAEzB,CAEQ,cAAcG,EAAW,CACxB,MAAA,GAAG,KAAK,UAAUA,GAC3B,CAuGD"}